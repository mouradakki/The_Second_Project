<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cart - My Project</title>
  <!-- font-awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <!-- favicon -->
  <link rel="icon" href="../img/favicon.ico" />
  <!-- css style -->
  <link rel="stylesheet" href="../style.css" />
  <!-- css responsive -->
  <link rel="stylesheet" href="../responsive.css" />
</head>

<body>
  <!-- Header -->
  <header id="Header">
    <a href="../index.html"><img src="../img/logo.png" alt="" class="logo" /></a>
    <nav>
      <ul id="navbar">
        <li><a href="../index.html">Home</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="blog.html">Blog</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li class="lg-bag">
          <a class="active" href="cart.html">
            <i class="fa-solid fa-bag-shopping head-cart"></i>
            <span class="cart-counter hidden" id="cart-counter">0</span>
          </a>
        </li>
        <a href="#" id="Close"><i class="fa-solid fa-xmark"></i></a>
      </ul>
    </nav>
    <div id="mobile">
      <a href="cart.html">
        <i class="fa-solid fa-bag-shopping head-cart"></i>
        <span class="cart-counter hidden" id="cart-counter-mobile">0</span>
      </a>
      <i id="bar" class="fa-solid fa-bars"></i>
    </div>
  </header>

  <!-- Page Header -->
  <section id="page-header" class="section-p1 animate-on-scroll">
    <h2>#cart</h2>
    <p>Add your coupon code & SAVE upto 70%!</p>
  </section>

  <!-- Cart -->
  <section id="cart" class="section-p1 animate-on-scroll">
    <div class="cart-container">
      <div class="cart-items" id="cart-items">
        <!-- Cart items will be dynamically loaded here -->
      </div>
      
      <div class="cart-summary">
        <div id="coupon">
          <h3>Apply Coupon</h3>
          <div>
            <input type="text" placeholder="Enter Your Coupon" />
            <button class="normal">Apply</button>
          </div>
        </div>

        <div id="subtotal">
          <h3>Cart Totals</h3>
          <div class="summary-item">
            <span>Cart Subtotal</span>
            <span id="cart-subtotal">$0</span>
          </div>
          <div class="summary-item">
            <span>Shipping</span>
            <span>Free</span>
          </div>
          <div class="summary-item total">
            <span><strong>Total</strong></span>
            <span id="cart-total"><strong>$0</strong></span>
          </div>
          <button class="normal checkout-btn" onclick="checkout()">
            <i class="fa-solid fa-credit-card"></i>
            Proceed to checkout
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- NewsLetter -->
  <section id="newsletter" class="section-p1 section-m1 animate-on-scroll">
    <div class="newstext">
      <h4>Sign Up For News Letters</h4>
      <p>
        Get email updates about our latest shop and
        <span>special offers.</span>
      </p>
    </div>
    <form class="form">
      <input type="text" placeholder="Your email address" />
      <button class="normal" type="submit">Sign Up</button>
    </form>
  </section>

  <!-- Footer -->
  <footer class="section-p1">
    <div class="col">
      <img src="../img/logo.png" alt="logo" class="logo" />
      <h4>Contact</h4>
      <p>
        <strong>Address:</strong>B2/238 Cyber Police Station Road, Rohini
        Sector 17, New Delhi
      </p>
      <p><strong>Phone:</strong>+01 2222 3665 / (+91) 01 2345 6763</p>
      <p><strong>Hours:</strong>10:00 - 18:00, Mon - Sat</p>

      <div class="follow">
        <h4>Follow us</h4>
        <div class="icon">
          <i class="fa-brands fa-facebook" aria-hidden="true"></i>
          <i class="fa-brands fa-instagram" aria-hidden="true"></i>
          <i class="fa-brands fa-linkedin" aria-hidden="true"></i>
          <i class="fa-brands fa-twitter" aria-hidden="true"></i>
        </div>
      </div>
    </div>

    <div class="col">
      <h4>About</h4>
      <a href="about.html">About Us</a>
      <a href="blog.html">Delivery Information</a>
      <a href="blog.html">Privacy Poilcy</a>
      <a href="blog.html">Terms &amp; Condition</a>
      <a href="contact.html">Contact Us</a>
    </div>
    <div class="col">
      <h4>My Account</h4>
      <a href="#newsLetter">Sign In</a>
      <a href="cart.html">View Cart</a>
      <a href="shop.html">My WishList</a>
      <a href="sproduct.html">Track My Order</a>
      <a href="contact.html">Help</a>
    </div>

    <div class="col install">
      <h4>Install App</h4>
      <p>From App Store or Google Play</p>
      <div class="row">
        <img src="../img/pay/app.jpg" alt="app" />
        <img src="../img/pay/play.jpg" alt="play" />
      </div>
      <p>Secured Payment Gateways</p>
      <img src="../img/pay/pay.png" alt="pay" />
    </div>
    <div class="copyright">
      <p>Â©2025 Mourad Akki Codes. All Rights Reseverd.</p>
    </div>
  </footer>

  <script src="../javascript.js"></script>
  <script>
    // Function to update cart counter
    function updateCartCounter() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
      
      const cartCounter = document.getElementById('cart-counter');
      const cartCounterMobile = document.getElementById('cart-counter-mobile');
      
      if (cartCounter) {
        cartCounter.textContent = totalItems;
        if (totalItems > 0) {
          cartCounter.classList.remove('hidden');
        } else {
          cartCounter.classList.add('hidden');
        }
      }
      
      if (cartCounterMobile) {
        cartCounterMobile.textContent = totalItems;
        if (totalItems > 0) {
          cartCounterMobile.classList.remove('hidden');
        } else {
          cartCounterMobile.classList.add('hidden');
        }
      }
    }

    // Load cart items when page loads
    document.addEventListener('DOMContentLoaded', function() {
      loadCart();
      updateCartCounter();
    });

    // Function to preload images
    function preloadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(src);
        img.onerror = () => reject(src);
        img.src = src;
      });
    }

    function loadCart() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const cartContainer = document.getElementById('cart-items');
      
      if (cart.length === 0) {
        cartContainer.innerHTML = `
          <div class="empty-cart">
            <i class="fa-solid fa-shopping-bag"></i>
            <h3>Your cart is empty</h3>
            <p>Looks like you haven't added any items to your cart yet.</p>
            <a href="shop.html" class="normal">Continue Shopping</a>
          </div>
        `;
        updateTotals(0);
        updateCartCounter(); // Update counter when cart is empty
        return;
      }

      let cartHTML = '';
      let total = 0;

      cart.forEach((item, index) => {
        const subtotal = item.price * item.quantity;
        total += subtotal;
        
        // Fix image path for cart page
        let imagePath = item.image;
        if (imagePath.startsWith('img/')) {
          imagePath = '../' + imagePath;
        }
        
        cartHTML += `
          <div class="cart-item">
            <div class="item-image">
              <img src="${imagePath}" alt="${item.name}" onerror="this.src='../img/products/a1.jpeg'" />
            </div>
            <div class="item-details">
              <h4>${item.name}</h4>
              <div class="item-price">$${item.price}</div>
              <div class="item-actions">
                <div class="quantity-controls">
                  <button onclick="updateQuantity(${index}, ${item.quantity - 1})" ${item.quantity <= 1 ? 'disabled' : ''}>
                    <i class="fa-solid fa-minus"></i>
                  </button>
                  <span class="quantity">${item.quantity}</span>
                  <button onclick="updateQuantity(${index}, ${item.quantity + 1})">
                    <i class="fa-solid fa-plus"></i>
                  </button>
                </div>
                <button class="remove-btn" onclick="removeItem(${index})">
                  <i class="fa-solid fa-trash"></i>
                  Remove
                </button>
              </div>
            </div>
            <div class="item-total">
              <span class="subtotal">$${subtotal}</span>
            </div>
          </div>
        `;
      });

      cartContainer.innerHTML = cartHTML;
      updateTotals(total);
      updateCartCounter(); // Update counter after loading cart
      
      // Preload images for better performance
      cart.forEach(item => {
        let imagePath = item.image;
        if (imagePath.startsWith('img/')) {
          imagePath = '../' + imagePath;
        }
        preloadImage(imagePath).catch(() => {
          // Image failed to load, will use fallback
        });
      });
    }

    function updateQuantity(index, newQuantity) {
      if (newQuantity < 1) return;
      
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      if (cart[index]) {
        cart[index].quantity = parseInt(newQuantity);
        localStorage.setItem('cart', JSON.stringify(cart));
        loadCart();
        updateCartCounter(); // Update counter when quantity changes
      }
    }

    function removeItem(index) {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      cart.splice(index, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
      loadCart();
      updateCartCounter(); // Update counter when item is removed
    }

    function updateTotals(total) {
      document.getElementById('cart-subtotal').textContent = `$${total}`;
      document.getElementById('cart-total').innerHTML = `<strong>$${total}</strong>`;
    }

    function checkout() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      if (cart.length === 0) {
        alert('Your cart is empty!');
        return;
      }
      alert('Thank you for your purchase! Redirecting to payment...');
      // Here you would typically redirect to a payment gateway
      // For now, we'll just clear the cart
      localStorage.removeItem('cart');
      loadCart();
      updateCartCounter(); // Update counter after checkout
    }
  </script>
</body>

</html>
